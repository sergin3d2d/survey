<!DOCTYPE html>
<html
    style="--global-font: {{ global_font_size|default(1.0) }}; --question-font: {{ question_font_size|default(1.6) }}rem; --desc-font: {{ description_font_size|default(1.4) }}rem;">

<head>
    <title>NASA-TLX</title>
    <style>
        html {
            font-size: calc(var(--global-font) * 10px);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f4f4f9;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }

        .container {
            background: #fff;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 800px;
        }

        h1 {
            text-align: center;
            color: #444;
            margin-bottom: 30px;
        }

        form {
            display: flex;
            flex-direction: column;
        }

        .question {
            margin-bottom: 40px;
            border-top: 1px solid #eee;
            padding-top: 30px;
        }

        .question label {
            font-size: var(--question-font);
            font-weight: 600;
            display: block;
            margin-bottom: 15px;
        }

        .scale {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }

        .scale span {
            flex: 0 0 60px;
            text-align: center;
            font-size: 0.9em;
            color: #555;
        }

        .slider-container {
            position: relative;
            flex-grow: 1;
            margin: 0 15px;
            padding-bottom: 30px;
            /* Space for the absolute positioned <output> */
        }

        .slider-container output {
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.9em;
            color: #555;
        }

        input[type="range"] {
            width: 100%;
            cursor: pointer;
            height: 44px;
            /* Matches thumb height to prevent clipping */
            -webkit-appearance: none;
            appearance: none;
            background: transparent;
            /* No background on the input itself */
            outline: none;
            margin: 10px 0;
        }

        /* WebKit/Blink (iOS Safari) Slider Thumb */
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            height: 44px;
            width: 44px;
            border-radius: 50%;
            background: #007bff;
            cursor: pointer;
            border: 4px solid #fff;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            margin-top: -15px;
            /* Centers 44px thumb on 14px track: (14-44)/2 */
            position: relative;
            z-index: 2;
        }

        /* Firefox Slider Thumb */
        input[type="range"]::-moz-range-thumb {
            height: 36px;
            width: 36px;
            border-radius: 50%;
            background: #007bff;
            cursor: pointer;
            border: 4px solid #fff;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }

        /* Track Styles */
        input[type="range"]::-webkit-slider-runnable-track {
            width: 100%;
            height: 14px;
            background: linear-gradient(to right, #007bff 0%, #007bff var(--value-percent, 50%), #ddd var(--value-percent, 50%), #ddd 100%);
            border-radius: 7px;
        }

        input[type="range"]::-moz-range-track {
            width: 100%;
            height: 14px;
            background: linear-gradient(to right, #007bff 0%, #007bff var(--value-percent, 50%), #ddd var(--value-percent, 50%), #ddd 100%);
            border-radius: 7px;
        }

        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em;
            margin-top: 20px;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="participant-id-display text-right">
            Participant ID: <strong>{{ participant_id }}</strong>
        </div>
        <h1>NASA-TLX: {{ condition }}</h1>
        <p style="font-size: var(--desc-font); line-height: 1.6; color: #666; margin-bottom: 40px;">
            Please rate your experience for the condition you just completed. Move each slider to the point that best
            reflects your experience. There are no right or wrong answers. You will complete these ratings for each
            condition (three in total).</p>
        <form action="/questionnaire" method="post">
            <input type="hidden" name="questionnaire_type" value="nasa_tlx">
            {% for i in range(texts|length) %}
            {% set val = existing_responses.get('q' ~ i, '50') %}
            <div class="question">
                <label>{{ texts[i] }}</label>
                <div class="scale">
                    <span>{{ left_labels[i] }}</span>
                    <div class="slider-container">
                        <input type="range" name="q{{ i }}" min="0" max="100" value="{{ val }}" step="1"
                            class="nasa-slider"
                            oninput="updateSliderFill(this); this.nextElementSibling.value = this.value + ' out of 100'">
                        <output>{{ val }} out of 100</output>
                    </div>
                    <span>{{ right_labels[i] }}</span>
                </div>
            </div>
            {% endfor %}
            <div class="navigation-buttons">
                <a href="/back" class="btn btn-secondary">Back</a>
                <button type="submit" class="btn btn-primary">Next</button>
            </div>
        </form>
    </div>
    <style>
        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .btn {
            border: none;
            padding: 15px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em;
            text-decoration: none;
            text-align: center;
            transition: background-color 0.3s;
        }

        .btn-primary {
            background-color: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background-color: #0056b3;
        }

        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
        }
    </style>
    <script>
        function updateSliderFill(slider) {
            const val = slider.value;
            slider.style.setProperty('--value-percent', val + '%');
        }

        // Initialize fills on page load
        document.addEventListener('DOMContentLoaded', function () {
            document.querySelectorAll('.nasa-slider').forEach(updateSliderFill);
        });
    </script>
</body>

</html>